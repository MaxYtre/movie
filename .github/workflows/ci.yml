name: CI - Run Tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: '[CI] 1. Checkout репозитория'
      uses: actions/checkout@v4

    - name: '[CI] 2. Настройка Python 3.11'
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip' # Кэширование зависимостей для ускорения сборок

    - name: '[CI] 3. Установка зависимостей из pyproject.toml'
      run: |
        echo "Установка зависимостей проекта..."
        python -m pip install --upgrade pip
        # Устанавливаем проект в режиме редактирования вместе с тестовыми зависимостями
        # Предполагается, что в pyproject.toml есть секция [project.optional-dependencies] с 'test'
        pip install -e .[test]

    - name: '[CI] 4. Запуск тестов с помощью pytest'
      env:
        PYTHONPATH: .
      run: |
        echo "Запуск тестов..."
        python -m pytest -vv