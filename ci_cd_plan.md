# План CI/CD для тестирования

## 1. Обзор

Этот документ описывает план по созданию нового рабочего процесса GitHub Actions для автоматического тестирования проекта. Цель — обеспечить, чтобы все изменения, вносимые в основную ветку, проходили проверку качества кода.

## 2. Имя и расположение файла

Новый рабочий процесс будет находиться в файле: `.github/workflows/ci.yml`.

## 3. Структура рабочего процесса (`ci.yml`)

```yaml
name: CI - Run Tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: '[CI] 1. Checkout репозитория'
      uses: actions/checkout@v4

    - name: '[CI] 2. Настройка Python 3.11'
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip' # Кэширование зависимостей для ускорения сборок

    - name: '[CI] 3. Установка зависимостей из pyproject.toml'
      run: |
        echo "Установка зависимостей проекта..."
        python -m pip install --upgrade pip
        # Устанавливаем проект в режиме редактирования вместе с тестовыми зависимостями
        # Предполагается, что в pyproject.toml есть секция [project.optional-dependencies] с 'test'
        pip install -e .[test]

    - name: '[CI] 4. Запуск тестов с помощью pytest'
      env:
        PYTHONPATH: .
      run: |
        echo "Запуск тестов..."
        python -m pytest -vv
```

## 4. Пояснения к плану

### 4.1. Триггеры (`on`)

*   `push: branches: [ main ]`: Рабочий процесс будет запускаться при каждом коммите в ветку `main`.
*   `pull_request: branches: [ main ]`: Рабочий процесс будет запускаться при создании или обновлении pull request, нацеленного на ветку `main`. Это ключевой момент для проверки изменений *перед* их слиянием.
*   `workflow_dispatch`: Позволяет запускать рабочий процесс вручную из интерфейса GitHub, что удобно для отладки.

### 4.2. Задачи (`jobs`)

*   **`test`**: Единственная задача, отвечающая за запуск тестов.
*   **`runs-on: ubuntu-latest`**: Используется последняя версия Ubuntu, что является стандартом для многих проектов.

### 4.3. Шаги (`steps`)

1.  **`[CI] 1. Checkout репозитория`**: Стандартный шаг для загрузки кода из репозитория в рабочую область runner'а.
2.  **`[CI] 2. Настройка Python 3.11`**: Устанавливает нужную версию Python. Добавлена опция `cache: 'pip'`, которая будет кэшировать установленные пакеты между запусками, что значительно ускорит последующие сборки.
3.  **`[CI] 3. Установка зависимостей из pyproject.toml`**: Это ключевое улучшение. Вместо ручной установки пакетов, как в `daily-update.yml`, мы используем стандартный способ управления зависимостями через `pyproject.toml`. Команда `pip install -e .[test]` установит проект в "редактируемом" режиме и зависимости, указанные в секции `[project.optional-dependencies]` для группы `test`.
4.  **`[CI] 4. Запуск тестов с помощью pytest`**:
    *   `env: PYTHONPATH: .`: Устанавливает переменную окружения, чтобы Python мог находить ваши модули.
    *   `python -m pytest -vv`: Запускает тесты с максимальной детализацией (`-vv`), что обеспечивает подробные и понятные логи в GitHub Actions.

### 4.4. Именование шагов

Шаги имеют префикс `[CI]` и нумерацию (`1.`, `2.`, ...). Это делает логи в интерфейсе GitHub Actions более структурированными и легко читаемыми, позволяя быстро находить нужный шаг.

## 5. Дальнейшие шаги

После утверждения этого плана можно будет переходить к созданию файла `.github/workflows/ci.yml`.